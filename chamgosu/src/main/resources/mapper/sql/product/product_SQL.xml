<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="product">
	<insert id="insertProduct" parameterType="hashmap">
		
		INSERT INTO CG_MARSTERGOODS(
			MG_ISBN,
			MG_BOOKNM,
			MG_BOOKSUBNM,
			MG_PBS,
			MG_BOOKWRITER,
			MG_PRICE,
			MG_SUBJECT,
			MG_OBJECT,
			MG_GRADE,
			MG_STEP,
			MG_BOOKISYEAR,
			MG_USERID,
			MG_APPLYCHK,
			MG_BOOKIMG,
			REGDATE
		)VALUES(
			#{MG_ISBN},
			#{MG_BOOKNM},
			#{MG_BOOKSUBNM},
			#{MG_PBS},
			#{MG_BOOKWRITER},
			#{MG_PRICE},
			#{MG_SUBJECT},
			#{MG_OBJECT},
			#{MG_GRADE},
			#{MG_STEP},
			#{MG_BOOKISYEAR},
			#{MG_USERID},
			#{MG_APPLYCHK},
			#{MG_BOOKIMG},
			CURDATE()
		)
		<selectKey resultType="int" order="AFTER">
			SELECT MAX(MG_SEQ) FROM CG_MARSTERGOODS
		</selectKey>
	</insert>
	<!-- 상품관리 List-->
	<insert id="insertSubProduct">
		INSERT INTO CG_REGIONGOODS(
			RG_MOREINF
			,RG_REFMAT
			,RG_USERID
			,RG_APPLYCHK
			,RG_REGIONCODE
			,RG_SPID
			,RG_SPRATE
			,RG_SPPRICE
			,RG_BOOKSEQ
			,RG_STOCKCNT
			,REGDATE
		)VALUES(
			#{RG_MOREINF}
			,#{RG_REFMAT}
			,#{RG_USERID}
			,#{RG_APPLYCHK}
			,#{RG_REGIONCODE}
			,#{RG_SPID}
			,#{RG_SPRATE}
			,#{RG_SPPRICE}
			,#{RG_BOOKSEQ}
			,#{RG_STOCKCNT}
			,CURDATE()
		)
	</insert>
	<select id="adminProductList" parameterType="hashmap" resultType="hashmap">
		select 
			MG_SEQ
			,MG_ISBN
			,MG_BOOKNM
			,MG_BOOKSUBNM
			,UDF_SELECT_CODE1NAME('02', MG_PBS) as MG_PBS
			,MG_BOOKWRITER
			,MG_PRICE
			,UDF_SELECT_CODE1NAME('03', MG_SUBJECT) as MG_SUBJECT
			,UDF_SELECT_CODE1NAME('04', MG_OBJECT) as MG_OBJECT
			,UDF_SELECT_CODE1NAME('05', MG_GRADE) as MG_GRADE
			,MG_STEP
			,MG_BOOKISYEAR
			,MG_USERID
			,MG_APPLYCHK
			,MG_BOOKIMG
			,RG_MOREINF
			,RG_REFMAT
			,RG_APPLYCHK
			,DATE_FORMAT( REGDATE,'%Y-%m-%d' ) as REGDATE
		from
		(
			select
				MG_SEQ
				,MG_ISBN
				,MG_BOOKNM
				,MG_BOOKSUBNM
				,MG_PBS
				,MG_BOOKWRITER
				,MG_PRICE
				,MG_SUBJECT
				,MG_OBJECT
				,MG_GRADE
				,MG_STEP
				,MG_BOOKISYEAR
				,MG_USERID
				,MG_APPLYCHK
				,MG_BOOKIMG
				,B.BSN_NM
				,R.RG_MOREINF
				,R.RG_REFMAT
				,R.RG_APPLYCHK
				,M.REGDATE
				, @rnum := @rnum + 1 as rn
			from
				(SELECT @rnum := 0) r,
				CG_MARSTERGOODS M
				LEFT JOIN CG_REGIONGOODS R
				ON M.MG_SEQ = R.RG_BOOKSEQ
				LEFT JOIN CG_BOOKSUBNM B
				ON R.RG_BOOKSUBNM = B.BSN_SEQ
			where
				1=1
			order by REGDATE desc
		) as list
		where list.rn between #{start} and #{end}
	</select>
	
	<select id="adminProductCnt" parameterType="hashmap" resultType="int">
		select COUNT(*) from CG_MARSTERGOODS where	1=1
	</select>
	
	<select id="adminProductAllCnt" parameterType="hashmap" resultType="int">
		select COUNT(*) from CG_MARSTERGOODS
	</select>
	
	<select id="codeList" parameterType="hashmap" resultType="hashmap">
		select
			CODE_IDX
			,CODE_FIRST
			,CODE_TWO
			,CODE_CODENAME
		from
			CG_CODE
		where
			CODE_ISUSE = 'Y'
			and CODE_FIRST != '#####'
			and CODE_IDX = #{code_idx}
	</select>
</mapper>