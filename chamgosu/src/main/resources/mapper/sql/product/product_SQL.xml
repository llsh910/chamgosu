<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="product">
	<insert id="insertProduct" parameterType="hashmap">
		
		INSERT INTO CG_MARSTERGOODS(
			MG_ISBN,
			MG_BOOKNM,
			MG_BOOKSUBNM,
			MG_PBS,
			MG_BOOKWRITER,
			MG_PRICE,
			MG_SUBJECT,
			MG_OBJECT,
			MG_GRADE,
			MG_STEP,
			MG_BOOKISYEAR,
			MG_USERID,
			MG_APPLYCHK,
			MG_BOOKIMG,
			MG_REFMAT,
			MG_MOREINF,
			REGDATE
		)VALUES(
			#{MG_ISBN},
			#{MG_BOOKNM},
			#{MG_BOOKSUBNM},
			#{MG_PBS},
			#{MG_BOOKWRITER},
			#{MG_PRICE},
			#{MG_SUBJECT},
			#{MG_OBJECT},
			#{MG_GRADE},
			#{MG_STEP},
			#{MG_BOOKISYEAR},
			#{MG_USERID},
			#{MG_APPLYCHK},
			#{MG_BOOKIMG},
			#{MG_REFMAT},
			#{MG_MOREINF},
			CURDATE()
		)
		<selectKey resultType="int" order="AFTER">
			SELECT MAX(MG_SEQ) FROM CG_MARSTERGOODS
		</selectKey>
	</insert>
	<select id="adminProductList" parameterType="hashmap" resultType="hashmap">
		select 
			MG_SEQ
			,MG_ISBN
			,MG_BOOKNM
			,MG_BOOKSUBNM
			,UDF_SELECT_CODE1NAME('02', MG_PBS) as MG_PBS
			,MG_BOOKWRITER
			,MG_PRICE
			,UDF_SELECT_CODE1NAME('03', MG_SUBJECT) as MG_SUBJECT
			,UDF_SELECT_CODE1NAME('04', MG_OBJECT) as MG_OBJECT
			,UDF_SELECT_CODE1NAME('05', MG_GRADE) as MG_GRADE
			,MG_STEP
			,MG_BOOKISYEAR
			,MG_USERID
			,MG_APPLYCHK
			,MG_BOOKIMG
			,MG_REFMAT
			,MG_MOREINF
			,DATE_FORMAT( REGDATE,'%Y-%m-%d' ) as REGDATE
		from
		(
			select
				MG_SEQ
				,MG_ISBN
				,MG_BOOKNM
				,MG_BOOKSUBNM
				,MG_PBS
				,MG_BOOKWRITER
				,MG_PRICE
				,MG_SUBJECT
				,MG_OBJECT
				,MG_GRADE
				,MG_STEP
				,MG_BOOKISYEAR
				,MG_USERID
				,MG_APPLYCHK
				,MG_BOOKIMG
				,MG_REFMAT
				,MG_MOREINF
				,DATE_FORMAT( REGDATE,'%Y-%m-%d' ) as REGDATE
				, @rnum := @rnum + 1 as rn
			from
				(SELECT @rnum := 0) r,
				CG_MARSTERGOODS
			where
				1=1
			order by MG_SEQ desc
		) as list
		where list.rn between #{start} and #{end}
	</select>
	
	<select id="adminProductCnt" parameterType="hashmap" resultType="int">
		select COUNT(*) from CG_MARSTERGOODS where	1=1
	</select>
	
	<select id="adminProductAllCnt" parameterType="hashmap" resultType="int">
		select COUNT(*) from CG_MARSTERGOODS
	</select>
	
	<select id="codeList" parameterType="hashmap" resultType="hashmap">
		select
			CODE_IDX
			,CODE_FIRST
			,CODE_TWO
			,CODE_CODENAME
		from
			CG_CODE
		where
			CODE_ISUSE = 'Y'
			and CODE_FIRST != '#####'
			and CODE_IDX = #{code_idx}
	</select>
	
	<select id="adminProductView" parameterType="hashmap" resultType="hashmap">
		select
			MG_SEQ
			,MG_ISBN
			,MG_BOOKNM
			,MG_BOOKSUBNM
			,MG_PBS
			,MG_BOOKWRITER
			,MG_PRICE
			,MG_SUBJECT
			,MG_OBJECT
			,MG_GRADE
			,MG_STEP
			,MG_BOOKISYEAR
			,MG_USERID
			,MG_APPLYCHK
			,MG_BOOKIMG
			,MG_REFMAT
			,MG_MOREINF
			,DATE_FORMAT( REGDATE,'%Y-%m-%d' ) as REGDATE
		from
			CG_MARSTERGOODS
		where
			MG_SEQ=#{mg_seq}
	</select>
	
	<update id="updateAdminProduct" parameterType="hashmap">
		update
			CG_MARSTERGOODS
		set
			MG_ISBN = #{MG_ISBN},
			MG_BOOKNM = #{MG_BOOKNM},
			MG_BOOKSUBNM = #{MG_BOOKSUBNM},
			MG_PBS = #{MG_PBS},
			MG_BOOKWRITER = #{MG_BOOKWRITER},
			MG_PRICE = #{MG_PRICE},
			MG_SUBJECT = #{MG_SUBJECT},
			MG_OBJECT = #{MG_OBJECT},
			MG_GRADE = #{MG_GRADE},
			MG_STEP = #{MG_STEP},
			MG_BOOKISYEAR = #{MG_BOOKISYEAR},
			MG_USERID = #{MG_USERID},
			MG_APPLYCHK = #{MG_APPLYCHK},
			MG_BOOKIMG = #{MG_BOOKIMG},
			MG_REFMAT = #{MG_REFMAT},
			MG_MOREINF = #{MG_MOREINF}
		where
			MG_SEQ = #{mg_seq}
	</update>
	
	<update id="productApplyUpdate" parameterType="hashmap">
		update
			CG_MARSTERGOODS
		set
			MG_APPLYCHK = #{mg_applychk}
		where
			MG_SEQ = #{mg_seq}
	</update>
</mapper>